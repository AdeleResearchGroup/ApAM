<!-- Copyright Universite Joseph Fourier (www.ujf-grenoble.fr) Licensed under 
	the Apache License, Version 2.0 (the "License"); you may not use this file 
	except in compliance with the License. You may obtain a copy of the License 
	at http://www.apache.org/licenses/LICENSE-2.0 Unless required by applicable 
	law or agreed to in writing, software distributed under the License is distributed 
	on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either 
	express or implied. See the License for the specific language governing permissions 
	and limitations under the License. -->

<apam xmlns="fr.imag.adele.apam" xmlns:ipojo="org.apache.felix.ipojo">

	<implementation name="S2Impl"
		classname="fr.imag.adele.apam.test.s2Impl.S2Impl" specification="S2"
		messages="{M5, M2, M3}">
		<properties shared="false" scope="global">
			<property test="yes" />
			<property b="yes" />
			<property c="xxx" />
			<property test-spec="anotherValue" />
		</properties>
		<definitions>
			<definition name="A1" type="string" />
			<definition name="A2" type="int" value="5" />
		</definitions>

		<dependencies>
			<specification name="S3">
				<interface field="s3s" />
				<interface field="s3_2" />
			</specification>
			<specification name="S3">
				<interface field="s3s2" />
				<interface field="s4_2" />
			</specification>
			<specification name="S3">
				<interface field="s3s" />
				<interface field="s3" />
			</specification>

			<interface field="s4_1" />
			<interface field="s4_2" />
			<message name="T2" />
			<message method="getT2" />
		</dependencies>
		<ipojo:requires field="apam" />
	</implementation>

	<implementation name="S2Simple"
		classname="fr.imag.adele.apam.test.s2Impl.S2Simple" specification="S2">
		<properties shared="false">
			<property test22="yes" />
		</properties>

		<dependencies>
			<specification name="S3">
				<interface field="s3" />
				<constraints>
					<implementation filter="(apam-composite=true)" />
					<instance filter="(SCOPE=GLOBAL)" />
					<instance filter="(c=GLOBAL)" />
					<instance filter="(cccc=GLOBAL)" />
				</constraints>
				<preferences>
					<implementation filter="(x=10)" />
					<instance filter="(b=false)" />
					<instance filter="(b2=false)" />
				</preferences>
			</specification>

			<interface field="s4">
				<constraints>
					<implementation filter="(apam-composite=true)" />
					<instance filter="(SCccOPE=GLOBAL)" />
				</constraints>
				<preferences>
					<implementation filter="(x2=10)" />
					<instance filter="(bxc=false)" />
				</preferences>
			</interface>
		</dependencies>
	</implementation>


	<implementation name="S2ImplBis"
		classname="fr.imag.adele.apam.test.s2Impl.S2ImplBis" specification="S2">
		<properties shared="true" scope="local">
			<property testbis="xyz" />
		</properties>
		<interface field="s4Bis" />
		<ipojo:requires field="apam" />
	</implementation>


	<composite name="S2Compo" specification="Syyy" mainImplem="S3Impl"
		messages="{M5, M6}"
		interfaces="{fr.imag.adele.apam.test.s2.SZZZ,fr.imag.adele.apam.apamAPI.YYYYYYY}">
		<properties shared="false" />
		<instances internal="true" local=".*" />
		<implementations internal="true" local="S.Im.*" />
		<!-- <dependency interface="fr.imag.adele.apam.test.s4.S4" source="S2" 
			/> <dependency specification="S5" source="S3" /> -->
		<dependencies>
			<specification name="S4" source="{S2,S3}" />
			<message name="msgType1" />
			<interface name="S4" />
		</dependencies>
	</composite>

	<instance implementation="S2Impl" name="toto">
		<properties shared="false">
			<property test-spec="coucous4" />
			<property A2="yes" />
			<property c3="xxx" />
			<property xyz="xxx" />
		</properties>
		<dependencies>
			<specification name="S3">
				<constraints>
					<implementation filter="(apam-composite=true)" />
					<instance filter="(SCccOPE=GLOBAL)" />
				</constraints>
				<preferences>
					<implementation filter="(x=10)" />
					<instance filter="(bxc=false)" />
				</preferences>
			</specification>
		</dependencies>
	</instance>
	
	<instance name="InstS2Impl" />
    <instance implementation="S2Simple" />
	<instance implementation="S3Impl" name="toto"/>
	<instance implementation="SXYZT" name="sdfg"/>

</apam>

