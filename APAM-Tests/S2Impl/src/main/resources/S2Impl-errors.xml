<!-- Copyright Universite Joseph Fourier (www.ujf-grenoble.fr) Licensed under 
	the Apache License, Version 2.0 (the "License"); you may not use this file 
	except in compliance with the License. You may obtain a copy of the License 
	at http://www.apache.org/licenses/LICENSE-2.0 Unless required by applicable 
	law or agreed to in writing, software distributed under the License is distributed 
	on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either 
	express or implied. See the License for the specific language governing permissions 
	and limitations under the License. -->

<apam xmlns="fr.imag.adele.apam" xmlns:ipojo="org.apache.felix.ipojo">

<!-- 
	<implementation name="S2Simple"
		classname="fr.imag.adele.apam.test.s2Impl.S2Simple" specification="S2">
		<dependency field="s3" />
		<dependency field="s4" />
	</implementation>
</apam>
 -->
<!-- 
	<specification name="S2" interfaces="{fr.imag.adele.apam.test.s2.S2, XXY}" messages="{M1}" >
		<properties>
		    <property shared="false"/>
		    <property scope="global"/>
			<property test-spec="coucou" type="string"/>
		</properties>
		<definitions>
			<definition name="b" type="boolean" value="true" />
			<definition name="c" type="string" />
			<definition name="Dd" type="int" />
		</definitions>

		<dependencies>
			<specification name="S3" />
			<interface name="example.S4" id="xx"/>
			<interface name="example.S3" id="xx" />
			<message name="example.DataType2" id="yy"/>
		</dependencies>
	</specification>

 -->
 <!-- 
	<specification name="S3"
		interfaces="[fr.imag.adele.apam.test.s3.S3_1,fr.imag.adele.apam.test.s3.S3_2]">
		<properties>
			<property test-deux="coucous3" type="string" />
			<property bS3="yes" />
			<property cS3="xxx" />
			<property test-deux="anotherValue" />
		</properties>
		<definitions>
			<definition name="x" type="string" />
			<definition name="MyBool" type="boolean" />
			<definition name="A2" type="int" value="5" />
		</definitions>
		<dependency specification="S4" />
	</specification>
  -->
  
	<implementation name="S2Impl"
		classname="fr.imag.adele.apam.test.s2Impl.S2Impl" specification="S2"
		messages="{M5, M2, M3}">						<!-- Message M1 missing -->
														<!-- Interfaces missing:{fr.imag.adele.apam.test.s2.S2, XXY} -->
		<properties> 
			<property shared="false" />
			<property borrowImplementation="true"/>
			<property test="yes" />					<!-- Attribute test undefined -->
			<property b="yes" />					<!-- b is boolean -->
			<property B="yes" />					<!-- Case ? -->
			<property c="xxx" />
			<property test-spec="anotherValue" />	<!-- Attribute re-defined -->
		</properties>
		<definitions>
			<definition name="A1" type="string" />
			<definition name="A2" type="int" value="xxxyyy" />
		</definitions>

		<dependencies>
			<specification name="S3">				<!-- ok-dependence multiple. defined 3 times. Id non defined -->
				<interface field="s3s" />
				<interface field="s3_2" />
			</specification>
			<specification name="S3">				<!-- re-defined  Id non defined -->
				<interface field="s3s2" />			<!-- Attribute s3s2 is collection -->
				<interface field="s4_2" />			<!-- Attribute s4-2 is simple. Not in S3 -->
			</specification>
			<specification name="S3">
				<interface field="s3s" />			<!-- Attribute s3s is allready defined collection -->
				<interface field="s3" />			<!-- Attribute s3 is simple -->
			</specification>

			<interface field="s4_1" />
			<interface field="s4_2" />		<!-- Field already defined -->
			<message name="T2" />  			<!-- Field missing -->
			<message method="getT2" />		<!-- Field missing -->
		</dependencies>
		<ipojo:requires field="apam" />
	</implementation>

	<implementation name="S2Simple"
		classname="fr.imag.adele.apam.test.s2Impl.S2Simple" specification="S2">
		<properties> 
			<property shared="false"/>
			<property test22="yes" /> 		<!--  test22 undefined -->
		</properties>

		<dependencies>
			<specification name="S3" id="S3Id">
				<interface field="s3" />
				<constraints>
					<implementation filter="(apam-composite=true)" />
					<instance filter="(SCOPE=GLOBAL)" /> 		<!--  SCOPE undefined -->
					<instance filter="(bS3=GLOBAL)" />
					<instance filter="(A5=GLOBAL)" />			<!--  A2 is an int -->
					<instance filter="(MyBool=tttt)" />			<!--  MyBool is boolean -->
					<instance filter="(MyBool=true)" />
					<instance filter="(mybool=false)" />		<!--  Case sensitive ? -->
					<instance filter="(&amp;(A2=5)(mybool=false))" />	
					<instance filter="(&amp;(A2=GLOBAL) (fghbsrthg=cc))" />		
				</constraints>
				<preferences>
					<implementation filter="(x=10)" />
					<instance filter="(b=false)" />
					<instance filter="(b2=false)" />
				</preferences>
			</specification>

			<interface field="s4" id="s4Id">
				<constraints>
					<implementation filter="(apam-composite=true)" />
					<instance filter="(SCccOPE=GLOBAL)" />
				</constraints>
				<preferences>
					<implementation filter="(x2=10)" />
					<instance filter="(bxc=false)" />
				</preferences>
			</interface>
		</dependencies>
	</implementation>


	<implementation name="S2ImplBis"
		classname="fr.imag.adele.apam.test.s2Impl.S2ImplBis" specification="S2">
		<properties> 
			<property shared="false" />
			<property borrowImplementation="false"/>
			<property borrowInstance="()interface=fr.imag.adele.apam.test.s3.S3"/>
			<property testbis="xyz" />
		</properties>
		<interface field="s4Bis" />
		<ipojo:requires field="apam" />
	</implementation>


	<composite name="S2Compo" specification="S2" mainImplem="S3Impl"
		messages="{M5, M6}"
		interfaces="{fr.imag.adele.apam.test.s2.SZZZ,fr.imag.adele.apam.apamAPI.YYYYYYY}"> <!-- interface does not exist -->
		<properties> 
			<property shared="false" />
			<property borrowInstance="false" />
			<property borrowImplementation="false" />
			<property localInstance="true" />
			<property localImplementation="(name=S.Im.*)" />
		</properties>
		
		<!-- 
		<instances internal="true" local=".*" />
		<implementations internal="true" local="S.Im.*" />
		<dependency interface="fr.imag.adele.apam.test.s4.S4" source="S2" 
			/> <dependency specification="S5" source="S3" /> 
		-->
		
		<dependencies>
			<specification name="S4" />
			<message name="msgType1" />
			<interface name="S4" />
		</dependencies>
	</composite>

	<instance implementation="S2Impl" name="toto">
		<properties> 
			<property shared="false" />
			<property test-spec="coucous4" />
			<property A2="yes" />
			<property c3="xxx" />
			<property b="bbb" />
			<property xyz="yyy" />
		</properties>
		<dependencies>
			<specification name="S3" id="S3Id">		<!-- id is undefined -->
				<constraints>
					<implementation filter="(apam-composite=true)" />
					<instance filter="(SCccOPE=GLOBAL)" /> <!-- attribute undefined -->
				</constraints>
				<preferences>
					<implementation filter="(x=10)" />
					<instance filter="(bxc=false)" />
				</preferences>
			</specification>
		</dependencies>
	</instance>
	
	<instance name="InstS2Impl" />					<!-- implementation is missing -->
    <instance implementation="S2Simple" /> 			<!-- name is missing -->
	<instance implementation="S3Impl" name="toto"/>	<!-- name toto is already used -->
	<instance implementation="SXYZT" name="sdfg"/>	<!-- implementation does not exist -->

</apam>


